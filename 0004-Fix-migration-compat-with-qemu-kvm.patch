From 99c9360e120aa7098952564af5bda76834498442 Mon Sep 17 00:00:00 2001
From: Cole Robinson <crobinso@redhat.com>
Date: Mon, 14 Jan 2013 21:49:21 -0500
Subject: [PATCH] Fix migration compat with qemu-kvm

Outlined here:
https://lists.gnu.org/archive/html/qemu-devel/2013-01/msg02340.html
https://lists.gnu.org/archive/html/qemu-devel/2013-01/msg02540.html
---
 hw/acpi_piix4.c |  2 +-
 hw/cirrus_vga.c |  2 +-
 hw/pc_piix.c    | 16 ----------------
 3 files changed, 2 insertions(+), 18 deletions(-)

diff --git a/hw/acpi_piix4.c b/hw/acpi_piix4.c
index 519269a..785e756 100644
--- a/hw/acpi_piix4.c
+++ b/hw/acpi_piix4.c
@@ -311,7 +311,7 @@ static int acpi_load_old(QEMUFile *f, void *opaque, int version_id)
 static const VMStateDescription vmstate_acpi = {
     .name = "piix4_pm",
     .version_id = 3,
-    .minimum_version_id = 3,
+    .minimum_version_id = 2,
     .minimum_version_id_old = 1,
     .load_state_old = acpi_load_old,
     .post_load = vmstate_acpi_post_load,
diff --git a/hw/cirrus_vga.c b/hw/cirrus_vga.c
index 9bef96e..8c94428 100644
--- a/hw/cirrus_vga.c
+++ b/hw/cirrus_vga.c
@@ -2975,7 +2975,7 @@ static int pci_cirrus_vga_initfn(PCIDevice *dev)
 
 static Property pci_vga_cirrus_properties[] = {
     DEFINE_PROP_UINT32("vgamem_mb", struct PCICirrusVGAState,
-                       cirrus_vga.vga.vram_size_mb, 8),
+                       cirrus_vga.vga.vram_size_mb, 16),
     DEFINE_PROP_END_OF_LIST(),
 };
 
diff --git a/hw/pc_piix.c b/hw/pc_piix.c
index aa3e7f4..ea37ef2 100644
--- a/hw/pc_piix.c
+++ b/hw/pc_piix.c
@@ -339,22 +339,6 @@ static QEMUMachine pc_machine_v1_2 = {
             .property = "param_change",\
             .value    = "off",\
         },{\
-            .driver   = "VGA",\
-            .property = "vgamem_mb",\
-            .value    = stringify(8),\
-        },{\
-            .driver   = "vmware-svga",\
-            .property = "vgamem_mb",\
-            .value    = stringify(8),\
-        },{\
-            .driver   = "qxl-vga",\
-            .property = "vgamem_mb",\
-            .value    = stringify(8),\
-        },{\
-            .driver   = "qxl",\
-            .property = "vgamem_mb",\
-            .value    = stringify(8),\
-        },{\
             .driver   = "virtio-blk-pci",\
             .property = "config-wce",\
             .value    = "off",\
-- 
1.8.1

